<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G11 Academic Excellence Portal | Ministry of Education</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        .no-select { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        #chat-popup { display: none; position: fixed; bottom: 85px; right: 15px; width: 330px; height: 480px; z-index: 5000; transition: transform 0.3s ease; }
        #pin-screen, #name-screen { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.98); z-index: 6000; }
        .theory-card { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .video-box { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 12px; overflow: hidden; background: #000; }
        .video-box iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-800 no-select font-sans">

    <nav class="bg-[#002b5b] text-white p-4 sticky top-0 z-[100] flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-3">
            <div class="bg-blue-500 p-1.5 rounded-lg shadow-inner">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
            </div>
            <h1 class="text-[11px] font-bold uppercase tracking-widest">Smart Revision</h1>
        </div>
    </nav>

    <main class="p-4 max-w-2xl mx-auto space-y-6">
        <section>
            <h2 class="text-sm font-bold text-slate-700 mb-3">Featured Video Lesson</h2>
            <div class="video-box shadow-xl border">
                <iframe src="https://www.youtube.com/embed/KXOyyhU6Wp4" frameborder="0" allowfullscreen></iframe>
            </div>
        </section>

        <section>
            <h2 class="text-sm font-bold text-slate-700 mb-3">ICT - Logic Gates Theory</h2>
            <div class="theory-card shadow-sm border-l-4 border-l-indigo-500">
                <p class="text-[11px] text-slate-600 leading-relaxed italic">The <b>AND gate</b> is a basic digital logic gate that implements logical conjunction. It behaves according to the truth table to the right.</p>
                

[Image of AND gate truth table]

            </div>
        </section>
    </main>

    <footer class="p-12 text-center text-slate-400 text-[10px] border-t">
        <p>Copyright © 2026 O/L Revision Portal. All <span id="unlock-trigger" class="cursor-pointer font-bold text-slate-500 hover:text-blue-600 transition-colors">Reserved</span></p>
    </footer>

    <div id="pin-screen" class="flex flex-col items-center justify-center p-6 backdrop-blur-md">
        <div class="w-full max-w-xs text-center bg-white p-10 rounded-3xl shadow-2xl border">
            <h2 class="text-slate-400 text-[10px] uppercase font-bold tracking-[0.3em] mb-10">Access Verification</h2>
            <input type="password" id="pin-input" maxlength="4" placeholder="0000" class="w-full text-center text-4xl border-b-2 border-slate-200 outline-none pb-4 text-blue-900 tracking-[1em] bg-transparent">
        </div>
    </div>

    <div id="name-screen" class="flex flex-col items-center justify-center p-6 backdrop-blur-md">
        <div class="w-full max-w-xs text-center bg-white p-10 rounded-3xl shadow-2xl border">
            <h2 class="text-slate-400 text-[10px] uppercase font-bold tracking-[0.2em] mb-6">Identify Yourself</h2>
            <input type="text" id="name-input" placeholder="Your Nickname" class="w-full text-center text-xl border-b-2 border-blue-500 outline-none pb-2 text-slate-800 bg-transparent mb-6">
            <button onclick="saveNameAndStart()" class="bg-blue-600 text-white px-6 py-2 rounded-full text-xs font-bold shadow-md active:scale-95 transition-all">Continue</button>
        </div>
    </div>

    <div id="chat-popup" class="bg-white rounded-3xl flex flex-col shadow-2xl border border-slate-100 overflow-hidden">
        <header class="bg-slate-50 p-4 border-b flex justify-between items-center">
            <span id="user-display" class="text-[9px] font-bold text-blue-600 uppercase tracking-widest"></span>
            <button onclick="closeChat()" class="text-slate-400">&times;</button>
        </header>
        <div id="chat-content" class="flex-1 overflow-y-auto p-4 space-y-4 bg-[#f8f9fc]"></div>
        <div class="p-4 border-t bg-white flex items-center gap-2">
            <input type="text" id="chat-msg" placeholder="Write a note..." class="flex-1 bg-slate-100 border-none rounded-full px-5 py-3 text-xs outline-none">
            <button onclick="sendChat()" class="bg-blue-600 text-white p-3 rounded-full shadow-lg">➔</button>
        </div>
    </div>

    <div id="overlay-detector" class="hidden fixed inset-0 z-[4000] bg-white/10 backdrop-blur-[2px]"></div>

    <script>
        const PIN_HASH = "81dc9bdb52d04dc20036dbd8313ed055"; // PIN: 1234
        const WEBHOOK_URL = "http://85.215.131.70:14045/api/chat";
        let lockTimer;

        // --- COOKIE HELPERS ---
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + "=" + value + ";expires=" + date.toUTCString() + ";path=/";
        }

        function getCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
            return null;
        }

        // --- AUTH FLOW ---
        document.getElementById('unlock-trigger').addEventListener('click', () => {
            document.getElementById('pin-screen').style.display = 'flex';
            document.getElementById('pin-input').focus();
        });

        document.getElementById('pin-input').addEventListener('input', (e) => {
            if (CryptoJS.MD5(e.target.value).toString() === PIN_HASH) {
                document.getElementById('pin-screen').style.display = 'none';
                checkIdentity();
            }
        });

        function checkIdentity() {
            const savedName = getCookie("chat_user");
            if (savedName) {
                openChat(savedName);
            } else {
                document.getElementById('name-screen').style.display = 'flex';
            }
        }

        function saveNameAndStart() {
            const name = document.getElementById('name-input').value.trim();
            if (name) {
                setCookie("chat_user", name, 30); // Save for 30 days
                document.getElementById('name-screen').style.display = 'none';
                openChat(name);
            }
        }

        function openChat(userName) {
            document.getElementById('user-display').innerText = "Logged in as: " + userName;
            document.getElementById('chat-popup').style.display = 'flex';
            document.getElementById('overlay-detector').classList.remove('hidden');
            resetLock();
        }

        function closeChat() {
            document.getElementById('chat-popup').style.display = 'none';
            document.getElementById('overlay-detector').classList.add('hidden');
            document.getElementById('pin-input').value = "";
        }

        function resetLock() {
            clearTimeout(lockTimer);
            if (document.getElementById('chat-popup').style.display === 'flex') {
                lockTimer = setTimeout(closeChat, 20000);
            }
        }

        window.addEventListener('touchstart', resetLock);
        document.addEventListener('visibilitychange', () => { if(document.hidden) closeChat(); });
        document.getElementById('overlay-detector').addEventListener('click', closeChat);

        // --- SEND MESSAGE ---
        async function sendChat() {
            const input = document.getElementById('chat-msg');
            const userName = getCookie("chat_user") || "Anonymous";
            if(!input.value) return;

            const box = document.getElementById('chat-content');
            const msg = document.createElement('div');
            msg.className = "ml-auto bg-blue-600 text-white p-3 rounded-2xl rounded-tr-none text-[11px] max-w-[85%] shadow-md";
            msg.innerText = input.value;
            box.appendChild(msg);
            box.scrollTop = box.scrollHeight;
            
            const text = input.value;
            input.value = "";

            try {
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: text, 
                        user: userName,
                        timestamp: new Date().toISOString() 
                    })
                });
            } catch (err) { console.log("Sent locally"); }
        }
    </script>
</body>
</html>
